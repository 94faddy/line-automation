<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LINE Web Automation - Multi Instance</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <link href="/css/style.css" rel="stylesheet">
</head>
<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-md-3 sidebar">
        <div class="sidebar-header">
          <h4><i class="bi bi-phone"></i> LINE Multi-Instance</h4>
          <small class="text-muted">Auto-Detect BlueStacks</small>
        </div>

        <!-- Instances List -->
        <div class="card mb-3">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span><i class="bi bi-collection"></i> Instances</span>
            <button class="btn btn-sm btn-outline-light" onclick="refreshInstances()">
              <i class="bi bi-arrow-clockwise"></i>
            </button>
          </div>
          <div class="card-body p-0">
            <div id="instances-list">
              <div class="text-center p-3">
                <div class="spinner-border spinner-border-sm" role="status"></div>
                <span class="ms-2">Detecting...</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="card mb-3">
          <div class="card-header">
            <i class="bi bi-lightning"></i> Quick Actions
          </div>
          <div class="card-body">
            <button class="btn btn-success btn-sm w-100 mb-2" onclick="startLineAll()">
              <i class="bi bi-play-fill"></i> Start All LINE Apps
            </button>
            <button class="btn btn-warning btn-sm w-100 mb-2" onclick="pauseAll()">
              <i class="bi bi-pause-fill"></i> Pause All
            </button>
            <button class="btn btn-danger btn-sm w-100 mb-2" onclick="stopAll()">
              <i class="bi bi-stop-fill"></i> Stop All
            </button>
            <button class="btn btn-secondary btn-sm w-100" onclick="resetAll()">
              <i class="bi bi-arrow-counterclockwise"></i> Reset All
            </button>
          </div>
        </div>

        <!-- Combined Stats -->
        <div class="card">
          <div class="card-header">
            <i class="bi bi-bar-chart"></i> Total Stats
          </div>
          <div class="card-body">
            <div class="status-item">
              <span>Instances:</span>
              <span id="total-instances" class="badge bg-primary">0</span>
            </div>
            <div class="status-item">
              <span>Total Sent:</span>
              <span id="total-sent" class="text-success">0</span>
            </div>
            <div class="status-item">
              <span>Total Failed:</span>
              <span id="total-failed" class="text-danger">0</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="col-md-9 main-content">
        <!-- Header -->
        <div class="content-header d-flex justify-content-between align-items-center">
          <h3><i class="bi bi-send"></i> Multi-Instance Message Sender</h3>
          <div>
            <span class="badge bg-info" id="mode-badge">Parallel Mode</span>
          </div>
        </div>

        <!-- Send Form -->
        <div class="card mb-4">
          <div class="card-header">
            <i class="bi bi-chat-dots"></i> Message Settings
          </div>
          <div class="card-body">
            <form id="send-form">
              <!-- Open LINE Button -->
              <div class="alert alert-warning mb-3" id="open-line-alert">
                <div class="d-flex justify-content-between align-items-center">
                  <span><i class="bi bi-exclamation-triangle"></i> <strong>LINE must be open on Home screen before sending!</strong></span>
                  <button type="button" class="btn btn-success" onclick="openLineAll()">
                    <i class="bi bi-play-fill"></i> Open LINE App
                  </button>
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label">Message <small class="text-muted">(English only - ADB limitation)</small></label>
                <textarea class="form-control" id="message" rows="3" placeholder="Enter your message here...">Hello! This is a test message from LINE automation.</textarea>
              </div>

              <!-- Instance Settings -->
              <div class="card mb-3">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                  <span><i class="bi bi-sliders"></i> Friends Settings</span>
                  <div class="form-check form-switch mb-0">
                    <input class="form-check-input" type="checkbox" id="sendAllFriends" checked>
                    <label class="form-check-label" for="sendAllFriends">Send to ALL friends</label>
                  </div>
                </div>
                <div class="card-body">
                  <div id="send-all-info" class="alert alert-info mb-0">
                    <i class="bi bi-info-circle"></i> Will send to <strong>ALL friends</strong> in your LINE friend list.
                    <br><small class="text-muted">Uncheck "Send to ALL friends" to specify a custom number.</small>
                  </div>
                  <div id="instance-settings" style="display: none;">
                    <p class="text-muted text-center">No instances detected. Click "Refresh" to detect.</p>
                  </div>
                </div>
              </div>

              <!-- Send Mode -->
              <div class="mb-3">
                <label class="form-label">Send Mode</label>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="sendMode" id="mode-parallel" value="parallel" checked>
                  <label class="form-check-label" for="mode-parallel">
                    <i class="bi bi-lightning"></i> Parallel (Send from all instances at the same time)
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="sendMode" id="mode-sequential" value="sequential">
                  <label class="form-check-label" for="mode-sequential">
                    <i class="bi bi-list-ol"></i> Sequential (Send one instance at a time)
                  </label>
                </div>
              </div>

              <!-- Control Buttons -->
              <div class="control-buttons">
                <button type="submit" class="btn btn-success btn-lg" id="btn-start">
                  <i class="bi bi-send-fill"></i> Start Sending All
                </button>
                <button type="button" class="btn btn-warning btn-lg" onclick="pauseAll()" id="btn-pause">
                  <i class="bi bi-pause-fill"></i> Pause All
                </button>
                <button type="button" class="btn btn-info btn-lg" onclick="resumeAll()" id="btn-resume">
                  <i class="bi bi-play-fill"></i> Resume All
                </button>
                <button type="button" class="btn btn-danger btn-lg" onclick="stopAll()" id="btn-stop">
                  <i class="bi bi-stop-fill"></i> Stop All
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Progress Cards -->
        <div class="row" id="progress-cards">
          <!-- จะถูกสร้างโดย JavaScript -->
        </div>

        <!-- Logs -->
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span><i class="bi bi-terminal"></i> Logs</span>
            <button class="btn btn-sm btn-outline-secondary" onclick="clearLogs()">
              <i class="bi bi-trash"></i> Clear
            </button>
          </div>
          <div class="card-body">
            <div class="log-box" id="log-box">
              <p class="text-muted">Waiting for logs...</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>
